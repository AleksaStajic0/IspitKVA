<div fxLayout="column" fxLayoutAlign="center center" fxLayoutGap="24px" class="cart-container">
  <mat-card fxFlex="95" fxFlex.gt-sm="85" fxFlex.gt-md="75" class="cart-card">
    <mat-card-header class="cart-header">
      <div mat-card-avatar class="cart-avatar">
        <mat-icon>shopping_cart</mat-icon>
      </div>
      <mat-card-title>Your Cart</mat-card-title>
      <mat-card-subtitle>{{ cartItems.length }} {{ cartItems.length === 1 ? 'item' : 'items' }} ready for checkout</mat-card-subtitle>
    </mat-card-header>

    <mat-card-content class="cart-content">

      <div *ngIf="cartItems.length === 0" fxLayout="column" fxLayoutAlign="center center" fxLayoutGap="16px" class="empty-cart">
        <mat-icon class="empty-cart-icon">movie_filter</mat-icon>
        <h3>Your cart is empty</h3>
        <p>Start adding some amazing movie screenings to your cart!</p>
      </div>


      <div *ngIf="cartItems.length > 0" class="cart-items">
        <mat-card *ngFor="let item of cartItems; let i = index; trackBy: trackByFn" class="cart-item-card" fxLayout="row" fxLayoutAlign="start center" fxLayoutGap="16px">

          <div class="poster-container" fxFlex="0 0 120px">
            <img 
              [src]="item.screening?.movie?.posterUrl || 'https://via.placeholder.com/120x180/424242/ffffff?text=No+Image'" 
              [alt]="item.screening?.movie?.title + ' poster'"
              class="movie-poster"
              (error)="$event.target.src='https://via.placeholder.com/120x180/424242/ffffff?text=No+Image'">
          </div>


          <div fxFlex fxLayout="column" fxLayoutGap="8px" class="movie-details">
            <div fxLayout="row" fxLayoutAlign="space-between start">
              <h3 class="movie-title">{{ item.screening?.movie?.title }}</h3>
              <button mat-icon-button color="warn" (click)="removeFromCart(item.id)" 
                      matTooltip="Remove from cart" aria-label="Remove from cart">
                <mat-icon>delete</mat-icon>
              </button>
            </div>

            <div fxLayout="row" fxLayoutGap="16px" class="movie-info">
              <mat-chip-set>
                <mat-chip>{{ item.screening?.movie?.genre }}</mat-chip>
                <mat-chip>{{ getFormattedDuration(item.screening?.movie?.duration) }}</mat-chip>
              </mat-chip-set>
            </div>

            <div fxLayout="column" fxLayoutGap="4px" class="screening-info">
              <div fxLayout="row" fxLayoutAlign="start center" fxLayoutGap="8px">
                <mat-icon class="info-icon">schedule</mat-icon>
                <span>{{ formatDateTime(item.screening.dateTime) }}</span>
              </div>
              
              <div fxLayout="row" fxLayoutAlign="start center" fxLayoutGap="8px">
                <mat-icon class="info-icon">event_seat</mat-icon>
                <span>{{ item.screening?.availableSeats }} seats available</span>
              </div>
              
              <div fxLayout="row" fxLayoutAlign="start center" fxLayoutGap="8px">
                <mat-icon class="info-icon">attach_money</mat-icon>
                <span class="price">{{ item.screening?.price | currency:'RSD':'symbol':'1.0-0' }}</span>
              </div>
            </div>

            <div *ngIf="item.screening?.movie?.rating" fxLayout="row" fxLayoutAlign="start center" fxLayoutGap="4px" class="rating">
              <mat-icon class="star-icon">star</mat-icon>
              <span>{{ item.screening?.movie?.rating }}/5</span>
            </div>
          </div>
        </mat-card>
      </div>
    </mat-card-content>

    <mat-card-actions *ngIf="cartItems.length > 0" fxLayout="column" fxLayoutGap="16px" class="cart-actions">
      <mat-card fxLayout="row" fxLayoutAlign="space-between center" class="total-card">
        <div fxLayout="column">
          <span class="total-label">Total Amount</span>
          <span class="item-count">{{ cartItems.length }} {{ cartItems.length === 1 ? 'item' : 'items' }}</span>
        </div>
        <div class="total-price">
          {{ cartTotal$ | async | currency:'RSD':'symbol':'1.0-0' }}
        </div>
      </mat-card>

      <div fxLayout="row" fxLayoutGap="12px" fxLayout.lt-sm="column">
        <button mat-stroked-button fxFlex.gt-xs="30" routerLink="/search">
          <mat-icon>arrow_back</mat-icon>
          Continue Shopping
        </button>
        
        <button mat-raised-button color="primary" fxFlex.gt-xs="70" 
                (click)="checkout()" 
                [disabled]="cartItems.length === 0 || isLoading">
          <mat-icon *ngIf="!isLoading">payment</mat-icon>
          <mat-spinner *ngIf="isLoading" diameter="20"></mat-spinner>
          {{ isLoading ? 'Processing...' : 'Checkout' }}
        </button>
      </div>
    </mat-card-actions>
  </mat-card>
</div>